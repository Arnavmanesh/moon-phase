<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Phase Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0a18;
            background-image: radial-gradient(circle at top left, #4a2a69, #0c0a18 40%);
            color: #e2e8f0; /* slate-200 */
        }
        .main-title {
            font-family: 'Cinzel', serif;
        }
        /* Glassmorphism card for the forecast */
        .forecast-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px); /* For Safari */
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: background 0.2s ease-in-out, transform 0.2s ease-in-out;
            flex-shrink: 0; /* Prevent cards from shrinking */
        }
        .forecast-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }
        .moon-icon {
            font-size: 10rem; /* Increased size */
            line-height: 1;
            text-shadow: 0 0 15px rgba(253, 224, 71, 0.4), 0 0 40px rgba(253, 224, 71, 0.3); /* Enhanced glow */
        }
        .forecast-icon {
            font-size: 3rem;
            line-height: 1;
        }
        .btn {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        .btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .btn:active {
            transform: scale(0.98);
        }
        #forecast-container {
            display: none; /* Initially hidden */
        }
        /* Custom scrollbar for forecast */
        #forecast-container::-webkit-scrollbar {
            height: 6px;
        }
        #forecast-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        #forecast-container::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        #forecast-container::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <main class="w-full max-w-5xl mx-auto text-center">
        <!-- App Title -->
        <h1 class="main-title text-4xl md:text-6xl font-bold text-slate-100 mb-12">Moon Phase Tracker</h1>

        <!-- Today's Moon Phase Section -->
        <section id="today-section" class="mb-8">
            <div id="today-content" class="flex flex-col items-center justify-center min-h-[250px]">
                <!-- Content will be injected here by JS -->
            </div>
        </section>

        <!-- Controls -->
        <div class="mb-8">
            <button id="forecast-btn" class="btn text-white font-bold py-3 px-6 rounded-lg shadow-lg">
                Show Next 7 Days
            </button>
        </div>

        <!-- 7-Day Forecast Section -->
        <div id="forecast-container" class="w-full overflow-x-auto pb-4">
            <section id="forecast-grid" class="flex flex-nowrap gap-4">
                <!-- Forecast cards will be injected here by JS -->
            </section>
        </div>

    </main>

    <script>
        // DOM Elements
        const todayContent = document.getElementById('today-content');
        const forecastGrid = document.getElementById('forecast-grid');
        const forecastBtn = document.getElementById('forecast-btn');
        const forecastContainer = document.getElementById('forecast-container');

        // --- Moon Phase Calculation Logic ---

        /**
         * Calculates moon phase and illumination for a given date.
         * @param {Date} date - The date to calculate for.
         * @returns {object} An object with the phase (0-1) and illumination (0-100).
         */
        function calculateMoonData(date) {
            const SYNODIC_MONTH = 29.53058867;
            const KNOWN_NEW_MOON = new Date('2000-01-06T18:14:00Z');
            const diffMilliseconds = date.getTime() - KNOWN_NEW_MOON.getTime();
            const diffDays = diffMilliseconds / (1000 * 60 * 60 * 24);
            let phase = (diffDays / SYNODIC_MONTH) % 1;
            if (phase < 0) {
                phase += 1;
            }
            const illumination = 50 * (1 - Math.cos(2 * Math.PI * phase));
            return { phase, illumination };
        }

        /**
         * Converts a moon phase value (0-1) to its name and emoji icon.
         * @param {number} phase - The moon phase value from calculation.
         * @returns {object} An object with the phase name and icon.
         */
        function getMoonPhaseInfo(phase) {
            if (phase < 0.03 || phase > 0.97) return { name: 'New Moon', icon: 'ðŸŒ‘' };
            if (phase < 0.24) return { name: 'Waxing Crescent', icon: 'ðŸŒ’' };
            if (phase < 0.26) return { name: 'First Quarter', icon: 'ðŸŒ“' };
            if (phase < 0.49) return { name: 'Waxing Gibbous', icon: 'ðŸŒ”' };
            if (phase < 0.51) return { name: 'Full Moon', icon: 'ðŸŒ•' };
            if (phase < 0.74) return { name: 'Waning Gibbous', icon: 'ðŸŒ–' };
            if (phase < 0.76) return { name: 'Last Quarter', icon: 'ðŸŒ—' };
            return { name: 'Waning Crescent', icon: 'ðŸŒ˜' };
        }

        // --- UI Rendering ---
        /**
         * Displays the calculated moon data on the page.
         */
        function displayData() {
            const today = new Date();

            // --- Display Today's Data ---
            const todayData = calculateMoonData(today);
            const todayPhaseInfo = getMoonPhaseInfo(todayData.phase);

            todayContent.innerHTML = `
                <div class="moon-icon">${todayPhaseInfo.icon}</div>
                <p class="text-4xl font-bold mt-4 main-title">${todayPhaseInfo.name}</p>
                <p class="text-slate-300 mt-2 text-lg">Illumination: ${todayData.illumination.toFixed(1)}%</p>
            `;

            // --- Prepare Forecast Data ---
            forecastGrid.innerHTML = ''; // Clear previous forecast
            for (let i = 1; i <= 7; i++) {
                const forecastDate = new Date();
                forecastDate.setDate(today.getDate() + i);

                const day = forecastDate.toLocaleDateString('en-US', { weekday: 'short' });
                const monthDay = forecastDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                
                const forecastData = calculateMoonData(forecastDate);
                const phaseInfo = getMoonPhaseInfo(forecastData.phase);

                const card = document.createElement('div');
                card.className = 'forecast-card p-4 rounded-lg flex flex-col items-center justify-center w-36 h-48';
                card.innerHTML = `
                    <p class="font-bold text-lg">${day}</p>
                    <p class="text-sm text-slate-400 mb-2">${monthDay}</p>
                    <div class="forecast-icon my-2">${phaseInfo.icon}</div>
                    <p class="text-sm mt-2 text-center font-semibold">${phaseInfo.name}</p>
                    <p class="text-xs text-slate-400 mt-1">${forecastData.illumination.toFixed(0)}%</p>
                `;
                forecastGrid.appendChild(card);
            }
        }

        // --- Event Listeners ---
        forecastBtn.addEventListener('click', () => {
            const isHidden = forecastContainer.style.display === 'none' || forecastContainer.style.display === '';
            if (isHidden) {
                forecastContainer.style.display = 'block';
                forecastBtn.textContent = 'Hide Forecast';
            } else {
                forecastContainer.style.display = 'none';
                forecastBtn.textContent = 'Show Next 7 Days';
            }
        });

        // --- Initial Load ---
        window.addEventListener('load', displayData);
    </script>
</body>
</html>
